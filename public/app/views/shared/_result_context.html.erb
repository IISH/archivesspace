<% unless result.is_a?(DigitalObject) || result.is_a?(DigitalObjectComponent) %>
  <div class="result_context">
    <%= render partial: 'shared/result_context_repo', locals: { :result => result } %>

    <% if result.respond_to?(:ancestors) && result.ancestors %>
      <% result.ancestors.each do |ancestor| %>
        <% identifier = ancestor.has_key?('id_0') ? (0..3).collect { |i| ancestor["id_#{i}"] }.compact.join('-') : nil %>
        <% title = process_mixed_content(ancestor.fetch('title', "[#{ ancestor.fetch('level', 'untitled')}]" )).html_safe %>
        <% ancestor_type = ancestor.fetch('uri').split('/')[3].chop %>
        <%= render partial: 'shared/result_context_ancestor', locals: {
          :span_class => "#{ancestor_type}_name",
          :badge_type => ancestor_type,
          :body => (identifier.blank? ? title : "#{identifier}, #{title}"),
          :url => app_prefix(ancestor.fetch('uri')) } %>
      <% end %>
    <% else %>
      <% unless props.fetch(:no_res, false) || result.resolved_resource.blank? %>
        <%= render partial: 'shared/result_context_ancestor', locals: {
          :span_class => 'resource_name',
          :badge_type => 'resource',
          :body => process_mixed_content(result.resolved_resource.fetch('title')).html_safe,
          :url => app_prefix(result.resolved_resource.fetch('uri')) } %>
      <% end %>
    <% end %>
  </div>

<% else %>

  <% if resolved_instances_record.linked_instances.length == 0 %>
    <section class="result_context">
      <%= render partial: 'shared/result_context_repo', locals: { :result => result } %>

      <% if result.respond_to?(:ancestors) && result.ancestors %>
        <% result.ancestors.each do |ancestor| %>
          <% ancestor_type = ancestor.fetch('uri').split('/')[3].chop %>
          <%= render partial: 'shared/result_context_ancestor', locals: {
            :span_class => "#{ancestor_type}_name",
            :badge_type => ancestor_type,
            :body => ancestor.fetch('title'),
            :url => app_prefix(ancestor.fetch('uri')) } %>
        <% end %>
      <% end %>
    </section>
  <% elsif resolved_instances_record.linked_instances.length > 0 %>
    <ol class="result_context" style="margin-bottom: 0; padding-left: 0; list-style: none;">
      <% resolved_instances_record.linked_instances.each do |uri, instance_record| %>
        <li>
          <%= render partial: 'shared/result_context_repo', locals: { :result => result } %>

          <% if instance_record.primary_type == 'resource' %>
          <%= render partial: 'shared/result_context_ancestor', locals: {
            :span_class => 'resource_name',
            :badge_type => 'resource',
            :body => instance_record.breadcrumb[0][:crumb],
            :url => app_prefix(uri) } %>
          <% elsif instance_record.primary_type == 'archival_object' %>
            <% instance_record.breadcrumb.each do |crumb| %>
              <% next if crumb[:uri].blank? %>
              <%= render partial: 'shared/result_context_ancestor', locals: {
                :span_class => "#{crumb[:type]}_name",
                :badge_type => crumb[:type],
                :body => crumb[:crumb],
                :url => app_prefix(crumb[:uri]) } %>
            <% end %>
          <% end %>
        </li>
      <% end %>
    </ol>
  <% end %>
<% end %>
